<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, minimum-scale=1">
    <title>分享应用</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --secondary-color: #5AC8FA;
            --background-color: #F2F2F7;
            --card-background: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #8E8E93;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--background-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--card-background);
            display: flex;
            align-items: center;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 100;
        }

        .back-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.3s ease;
            margin-right: auto;
        }

        .back-btn img {
            width: 24px;
            height: 24px;
        }

        .nav-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 17px;
            font-weight: 600;
        }
        
        /* 内容容器样式 */
        .content-wrapper {
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: calc(100vh - 56px);
            overflow: hidden;
            z-index: 1;
        }
        
        /* 网页框样式 */
        #webFrame {
            width: 100%;
            height: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }
        
        /* 底部遮挡块样式 */
        .bottom-mask {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 44px;
            background-color: #f9fafb;
            z-index: 20;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div class="nav-bar">
        <div class="back-btn" onclick="history.back()">
            <img src="https://creation.bcmcdn.com/716/appcraft/IMAGE_eAXbCvfiS_1762594008771.png" alt="返回">
        </div>
        <div class="nav-title">一起跨年</div>
    </div>

    <!-- 内容容器 -->
    <div class="content-wrapper">
        <!-- 网页框 -->
        <iframe id="webFrame"></iframe>
        
        <!-- 底部遮挡块 -->
        <div class="bottom-mask"></div>
    </div>

    <script>
        // 页面加载完成后执行
        window.onload = function() {
            // 从localStorage获取usermail和username值
            const mail = localStorage.getItem('usermail') || '';
            const username = localStorage.getItem('username') || '';
            console.log('调试 - 从localStorage获取的usermail值:', mail);
            console.log('调试 - 从localStorage获取的username值:', username);
            
            // 构建iframe的URL
            const baseUrl = 'https://dazzling-popup-party.nocode.host';
            console.log('调试 - baseUrl:', baseUrl);
            
            // 构建查询参数
            let params = new URLSearchParams();
            if (mail) params.append('mail', encodeURIComponent(mail));
            if (username) params.append('name', encodeURIComponent(username));

            // 检查localStorage中的剪贴板内容
            const clipboardContent = localStorage.getItem('clipboardContent');
            if (clipboardContent) {
                console.log('检测到剪贴板内容:', clipboardContent);
                params.append('url', encodeURIComponent(clipboardContent));
                localStorage.removeItem('clipboardContent');
                console.log('已删除localStorage中的剪贴板内容');
            }

            const paramsString = params.toString();
            const iframeUrl = paramsString ? `${baseUrl}?${paramsString}` : baseUrl;
            console.log('调试 - 构建的iframeUrl:', iframeUrl);
            
            // 设置iframe的src
            document.getElementById('webFrame').src = iframeUrl;
            console.log('调试 - iframe的src已设置');
        };
    </script>
    <script>
        document.addEventListener('plusready', function() {  
            var webview = plus.webview.currentWebview();  
            plus.key.addEventListener('backbutton', function() {  
                webview.canBack(function(e) {  
                    if(e.canBack) {  
                        webview.back();  
                    } else {  
                        webview.close(); //hide,quit  
                        //plus.runtime.quit();  
                    }  
                })  
            });  
        });
    // 禁用移动端缩放
    if (/Mobi|Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent)) {
      document.addEventListener('touchstart', function (event) {
        if (event.touches.length > 1) event.preventDefault();
      }, { passive: false });
      document.addEventListener('gesturestart', function (event) {
        event.preventDefault();
      });
      document.addEventListener('wheel', function (event) {
        if (event.ctrlKey) event.preventDefault();
      }, { passive: false });
      document.addEventListener('keydown', function (event) {
        if (event.ctrlKey && (event.key === '+' || event.key === '-' || event.key === '=')) {
          event.preventDefault();
        }
      });
    }
    </script>
</body>
</html>
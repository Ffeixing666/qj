<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- Web App Manifest -->
<link rel="manifest" href="/blog/manifest.json">

<!-- iOS Meta Tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="趣加">

<!-- 主题色 -->
<meta name="theme-color" content="#2196f3">

<!-- 使用同一张图片作为iOS图标 -->
<link rel="apple-touch-icon" href="https://static.codemao.cn/coco/player/unstable/SkKneVXYR.image/png?hash=Ftv6S3_TwwLgokegSiqV7OMtziE0">
<!-- 以上内容适配iOSpwa -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>趣加 - 内嵌网页</title>
    <script>
        document.addEventListener('plusready', function() {  
    var webview = plus.webview.currentWebview();  
    plus.key.addEventListener('backbutton', function() {  
        webview.canBack(function(e) {  
            if(e.canBack) {  
                webview.back();  
            } else {  
                webview.close(); //hide,quit  
                //plus.runtime.quit();  
            }  
        })  
    });  
});
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background-color: #f5f5f5; }
        
        /* 顶部导航栏 */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
        }
        .navbar img {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        /* 网页框 */
        .iframe-container {
            position: absolute;
            top: 50px; /* 导航栏高度 */
            left: 0;
            width: 100%;
            bottom: 0;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>

    <!-- 顶部导航 -->
    <div class="navbar">
        <img src="https://static.codemao.cn/pickduck/HJX2Jpcjkx.jpeg?hash=FlAzmrOiGSJSKBVSHudLfeU_02s4" alt="返回" id="backBtn">
        <img src="https://static.codemao.cn/pickduck/HksR1a5o1l.jpeg?hash=FntcWBPOUsAh7x0MeQ0-RQB39Nnt" alt="分享" id="shareBtn">
    </div>

    <!-- 内嵌网页 -->
    <div class="iframe-container">
        <iframe id="webFrame" src=""></iframe>
    </div>

    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 从URL中提取ID参数的值
        function extractIdFromUrl(url) {
            try {
                const urlObj = new URL(url);
                const idParam = urlObj.searchParams.get('id');
                return idParam;
            } catch (e) {
                // 如果URL解析失败，尝试使用字符串方法
                const match = url.match(/[?&]id=([^&]+)/);
                return match ? match[1] : null;
            }
        }

        // 增强的复制函数，包含多种备用方案
        function copyToClipboardWithFallback(text) {
            // 方案1: 使用现代Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        console.log('复制成功 (现代API)');
                        showCopySuccess();
                    })
                    .catch(err => {
                        console.warn('现代API复制失败，尝试备用方案:', err);
                        tryFallbackMethods(text);
                    });
            } else {
                // 直接使用备用方案
                tryFallbackMethods(text);
            }
        }

        function tryFallbackMethods(text) {
            // 方案2: 使用HTML5+的复制功能
            if (window.plus && plus.device) {
                try {
                    plus.device.setClipboard(text, function() {
                        console.log('复制成功 (HTML5+)');
                        showCopySuccess();
                    }, function(err) {
                        console.warn('HTML5+复制失败:', err);
                        tryExecCommand(text);
                    });
                    return;
                } catch (e) {
                    console.warn('HTML5+复制异常:', e);
                }
            }
            
            // 方案3: 使用传统的execCommand
            tryExecCommand(text);
        }

        function tryExecCommand(text) {
            // 方案3.1: 创建textarea元素方式
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            textArea.style.opacity = '0';
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    console.log('复制成功 (execCommand)');
                    showCopySuccess();
                } else {
                    console.warn('execCommand复制失败');
                    tryInputMethod(text);
                }
            } catch (err) {
                document.body.removeChild(textArea);
                console.warn('execCommand复制异常:', err);
                tryInputMethod(text);
            }
        }

        function tryInputMethod(text) {
            // 方案4: 使用input元素方式（兼容性更好）
            const input = document.createElement('input');
            input.value = text;
            input.style.position = 'fixed';
            input.style.top = '0';
            input.style.left = '0';
            input.style.width = '100px';
            input.style.height = '20px';
            input.style.opacity = '0';
            input.style.zIndex = '-9999';
            
            document.body.appendChild(input);
            input.select();
            input.setSelectionRange(0, 99999); // 对于移动设备
            
            try {
                const successful = document.execCommand('copy');
                document.body.removeChild(input);
                
                if (successful) {
                    console.log('复制成功 (input方法)');
                    showCopySuccess();
                } else {
                    console.warn('input方法复制失败');
                    tryPromptMethod(text);
                }
            } catch (err) {
                document.body.removeChild(input);
                console.warn('input方法复制异常:', err);
                tryPromptMethod(text);
            }
        }

        function tryPromptMethod(text) {
            // 方案5: 使用prompt提示用户手动复制
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // 移动设备：显示提示框让用户手动复制
                alert('请手动复制以下内容：\n\n' + text + '\n\n提示：长按选择文本进行复制');
            } else {
                // PC设备：使用prompt
                prompt('请按Ctrl+C复制以下内容：', text);
            }
            
            // 即使手动复制也显示成功，因为用户已经看到提示
            setTimeout(showCopySuccess, 500);
        }

        function showCopySuccess() {
            // 显示复制成功提示
            if (typeof plus !== 'undefined' && plus.nativeUI) {
                // 使用HTML5+的提示
                plus.nativeUI.toast('文章链接已复制到剪切板，快去粘贴吧～');
            } else {
                // 使用普通alert
                alert('文章链接已复制到剪切板，快去粘贴吧～');
            }
        }

        // 保留原有的copyToClipboard函数用于兼容
        function copyToClipboard(text) {
            copyToClipboardWithFallback(text);
        }

        const iframe = document.getElementById('webFrame');
        let pageUrl = getQueryParam('url');
        let userId = localStorage.getItem('userid');

        if (pageUrl) {
            pageUrl = decodeURIComponent(pageUrl);
            if (pageUrl.includes('article.html') && userId) {
                pageUrl += `&user=${userId}`;
            }
            iframe.src = pageUrl;
        } else {
            iframe.src = 'about:blank';
        }

        document.getElementById('backBtn').addEventListener('click', () => {
            window.history.back();
        });

        document.getElementById('shareBtn').addEventListener('click', () => {
            // 获取当前页面URL参数中的url值
            const currentPageUrl = getQueryParam('url');
            
            if (currentPageUrl && currentPageUrl.includes('article.html')) {
                // 提取ID参数的值
                const idValue = extractIdFromUrl(currentPageUrl);
                
                if (idValue) {
                    // 构建分享链接
                    const shareUrl = `https://corsproxy.io/https://qujiaweb.top/blog/sharearticle.html?id=${idValue}&user=1754281004`;
                    
                    // 使用增强的复制方法
                    copyToClipboardWithFallback('https://qujiaweb.top/blog');
                } else {
                    copyToClipboardWithFallback('https://qujiaweb.top/blog');
                    alert('已复制APP分享链接');
                }
            } else {
                alert('已复制APP分享链接');
            }
        });
    </script>

    <script>
        document.addEventListener('webkitfullscreenchange', function() {  
    var el = document.webkitFullscreenElement; //获取全屏元素  
    if(el) {  
        plus.screen.lockOrientation('landscape'); //锁死屏幕方向为横屏  
    } else {  
        plus.screen.unlockOrientation(); //解除屏幕方向的锁定  
    }  
});
    </script>
 </body>
</html>
